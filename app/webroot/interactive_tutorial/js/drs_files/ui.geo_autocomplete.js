$.widget("ui.geo_autocomplete",{_init:function(){this.options._geocoder=new google.maps.Geocoder;this.options._cache={};this.element.autocomplete(this.options);this.element.data("autocomplete")._renderItem=function(b,a){return $("<li></li>").data("item.autocomplete",a).append(this.options.getItemHTML(a)).appendTo(b)}},options:{geocoder_region:"USA",geocoder_types:"locality",geocoder_address:false,mapwidth:100,mapheight:100,maptype:"terrain",mapsensor:false,minLength:3,delay:300,source:function(a,c){if(a.term in this.options._cache)c(this.options._cache[a.term]);else{var b=this,d=a.term+(this.options.geocoder_region?", "+this.options.geocoder_region:"");this.options._geocoder.geocode({address:d},function(e,f){var d=[];if(e&&f&&f=="OK"){var g=b.options.geocoder_types.split(",");$.each(e,function(h,c){if($.map(c.types,function(a){return $.inArray(a,g)!=-1?a:null}).length&&c.geometry&&c.geometry.viewport){if(b.options.geocoder_address)e=c.formatted_address;else{var f=c.formatted_address.split(","),e=f[0];$.each(f,function(c,b){if(b.toLowerCase().indexOf(a.term.toLowerCase())!=-1){e=$.trim(b);return false}})}d.push({value:e,label:c.formatted_address,viewport:c.geometry.viewport})}})}b.options._cache[a.term]=d;c(d)})}},getItemHTML:function(a){var b=a.label.split(",");return b[0]}}})