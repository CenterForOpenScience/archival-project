(function(){window.ensure=function(a,c,d){if(typeof jQuery=="undefined"&&typeof Sys=="undefined"&&typeof Prototype=="undefined")return alert("jQuery, Microsoft ASP.NET AJAX or Prototype library not found. One must be present for ensure to work");if(typeof a.test!="undefined"){var b=function(){return a.test};if(typeof a.test=="string")b=function(){return!(eval("typeof "+a.test)=="undefined"&&document.getElementById(a.test)==null)};else if(typeof a.test=="function")b=a.test;if(b()===false||typeof b()=="undefined"||b()==null)new ensureExecutor(a,c,d);else c()}else new ensureExecutor(a,c,d)};window.ensureExecutor=function(a,c,b){this.data=this.clone(a);this.callback=typeof b=="undefined"||null==b?c:this.delegate(c,b);this.loadStack=[];if(a.js&&a.js.constructor!=Array)this.data.js=[a.js];if(a.html&&a.html.constructor!=Array)this.data.html=[a.html];if(a.css&&a.css.constructor!=Array)this.data.css=[a.css];if(typeof a.js=="undefined")this.data.js=[];if(typeof a.html=="undefined")this.data.html=[];if(typeof a.css=="undefined")this.data.css=[];this.init();this.load()};window.ensureExecutor.prototype={init:function(){if(typeof jQuery!="undefined"){this.getJS=a.loadJavascript_jQuery;this.httpGet=a.httpGet_jQuery}else if(typeof Prototype!="undefined"){this.getJS=a.loadJavascript_Prototype;this.httpGet=a.httpGet_Prototype}else if(typeof Sys!="undefined"){this.getJS=a.loadJavascript_MSAJAX;this.httpGet=a.httpGet_MSAJAX}else throw"jQuery, Prototype or MS AJAX framework not found";},getJS:function(){},httpGet:function(){},load:function(){this.loadJavascripts(this.delegate(function(){this.loadCSS(this.delegate(function(){this.loadHtml(this.delegate(function(){this.callback()}))}))}))},loadJavascripts:function(c){var b=this.data.js.length;if(0===b)return c();this.forEach(this.data.js,function(c){if(a.isUrlLoaded(c)||this.isTagLoaded("script","src",c))b--;else this.getJS({url:c,success:this.delegate(function(){b--;a.registerUrl(c)}),error:this.delegate(function(a){b--;typeof this.data.error=="function"&&this.data.error(c,a)})})});this.until({test:function(){return b===0},delay:50,callback:this.delegate(function(){c()})})},loadCSS:function(b){if(0===this.data.css.length)return b();var c=a.getHead();this.forEach(this.data.css,function(b){if(!(a.isUrlLoaded(b)||this.isTagLoaded("link","href",b))){var d=this;try{(function(c,d){var b=document.createElement("link");b.setAttribute("href",c);b.setAttribute("rel","Stylesheet");b.setAttribute("type","text/css");d.appendChild(b);a.registerUrl(c)}).apply(window,[b,c])}catch(e){typeof d.data.error=="function"&&d.data.error(b,e.message)}}});b()},loadHtml:function(c){var b=this.data.html.length;if(0===b)return c();this.forEach(this.data.html,function(c){if(a.isUrlLoaded(c))b--;else this.httpGet({url:c,success:this.delegate(function(e){b--;a.registerUrl(c);var d=this.data.parent||document.body.appendChild(document.createElement("div"));if(typeof d=="string")d=document.getElementById(d);d.innerHTML=e}),error:this.delegate(function(a){b--;typeof this.data.error=="function"&&this.data.error(c,a)})})});this.until({test:function(){return b===0},delay:50,callback:this.delegate(function(){c()})})},clone:function(e){var b={};for(var c in e){var a=e[c];if(typeof a=="object")if(a.constructor==Array){for(var f=[],d=0;d<a.length;d++)f.push(a[d]);b[c]=f}else b[c]=this.clone(a);else b[c]=a}return b},forEach:function(b,c){for(var d=this,a=0;a<b.length;a++)c.apply(d,[b[a]])},delegate:function(b,c){var a=c||this;return function(){b.apply(a,arguments)}},until:function(a){if(a.test()===true)a.callback();else window.setTimeout(this.delegate(function(){this.until(a)}),a.delay||50)},isTagLoaded:function(c,a,e){var d=document.createElement(c);d[a]=e;var b=false,f=document.getElementsByTagName(c);this.forEach(f,function(c){if(d[a]===c[a]){b=true;return false}});return b}};var b=navigator.userAgent.toLowerCase(),a={browser:{version:(b.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],safari:/webkit/.test(b),opera:/opera/.test(b),msie:/msie/.test(b)&&!/opera/.test(b),mozilla:/mozilla/.test(b)&&!/(compatible|webkit)/.test(b)},loadedUrls:{},isUrlLoaded:function(b){return a.loadedUrls[b]===true},unregisterUrl:function(b){a.loadedUrls[b]=false},registerUrl:function(b){a.loadedUrls[b]=true},createScriptTag:function(f,c,d){var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("src",f);b.onload=b.onreadystatechange=function(){(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")&&c()};b.onerror=function(){d(data.url+" failed to load")};var e=a.getHead();e.appendChild(b)},getHead:function(){return document.getElementsByTagName("head")[0]||document.documentElement},globalEval:function(c){var b=document.createElement("script");b.type="text/javascript";if(a.browser.msie)b.text=c;else b.appendChild(document.createTextNode(c));var d=a.getHead();d.appendChild(b)},loadJavascript_jQuery:function(b){a.createScriptTag(b.url,b.success,b.error)},loadJavascript_MSAJAX:function(b){a.createScriptTag(b.url,b.success,b.error)},loadJavascript_Prototype:function(b){a.createScriptTag(b.url,b.success,b.error)},httpGet_jQuery:function(a){return jQuery.ajax({type:"GET",url:a.url,data:null,success:a.success,error:function(b,d,c){if(b&&b.responseText)a.error(b.responseText);else a.error("Error occured while loading: "+url+"\n"+c.message)},dataType:a.type||"html"})},httpGet_MSAJAX:function(b){var a=new Sys.Net.WebRequest;a.set_url(b.url);a.set_httpVerb("GET");a.add_completed(function(a){var c="Failed to load:"+b.url;if(a.get_timedOut())c="Timed out";if(a.get_aborted())c="Aborted";if(a.get_responseAvailable())b.success(a.get_responseData());else b.error(c)});var c=new Sys.Net.XMLHttpExecutor;a.set_executor(c);c.executeRequest()},httpGet_Prototype:function(a){new Ajax.Request(a.url,{method:"get",evalJS:false,onSuccess:function(b){a.success(b.responseText||"")},onFailure:a.error})}}})()